/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/repeat-form/repeat-form.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ContentChild, EventEmitter, Input, Output, TemplateRef } from '@angular/core';
import { FormBuilder, FormGroupDirective, Validators } from '@angular/forms';
export class RepeatFormComponent {
    /**
     * @param {?} parentForm
     * @param {?} formBuilder
     */
    constructor(parentForm, formBuilder) {
        this.parentForm = parentForm;
        this.formBuilder = formBuilder;
        this.readOnly = false;
        this.required = true;
        this.minNumber = 1;
        this.inputNumberLabel = '';
        this.removeLabel = '';
        this.confirmLabel = '';
        this.errorMessages = {
            required: 'Ce champ est obligatoire',
            pattern: 'Le format n\'est pas correct',
            min: 'Le nombre de répétition n\'est pas assez grand',
            max: 'Le nombre de répétition est trop grand'
        };
        this.header = '';
        this.isFormTouched = false;
        this.entreprisesSizeVide = false;
        this.addedForm = new EventEmitter();
        this.addedFormZero = new EventEmitter();
        this.numberRegexPattern = /^\d+$/;
        this.isMinZeroReadOnly = false;
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.initForm();
        this.patchForm();
        this.patchFormSizeVide();
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.isFormTouched) {
            this.formSize.controls['SIZE'].markAsTouched();
        }
    }
    /**
     * @private
     * @return {?}
     */
    initForm() {
        this.form = (/** @type {?} */ (this.parentForm.form.get(this.controlName)));
        /** @type {?} */
        const validators = this.buildSizeValidators();
        this.formSize = this.formBuilder.group({
            SIZE: ['', validators]
        });
        if (this.readOnly) {
            this.formSize.disable();
        }
    }
    /**
     * @private
     * @return {?}
     */
    patchForm() {
        /** @type {?} */
        const initialFormSize = this.form.length === 0 ? '' : this.form.length;
        this.formSize.get('SIZE').setValue(initialFormSize);
        if (initialFormSize) {
            this.confirmSize();
        }
    }
    /**
     * @private
     * @return {?}
     */
    patchFormSizeVide() {
        if (this.minNumber == 0 && this.entreprisesSizeVide) {
            /** @type {?} */
            const initialFormSize = this.form.length;
            this.formSize.get('SIZE').setValue('0');
            this.isMinZeroReadOnly = true;
        }
    }
    /**
     * @private
     * @return {?}
     */
    buildSizeValidators() {
        /** @type {?} */
        let validators = [Validators.pattern(this.numberRegexPattern)];
        if (this.required) {
            validators.push(Validators.required);
        }
        if (this.minNumber) {
            validators.push(Validators.min(this.minNumber));
        }
        if (this.maxNumber && this.maxNumber > 0) {
            validators.push(Validators.max(this.maxNumber));
        }
        return validators;
    }
    /**
     * @return {?}
     */
    confirmSize() {
        this.formSize.get('SIZE').markAsTouched();
        if (this.formSize.valid) {
            while (!this.isMaxSizeReached() && !this.isMinSizeZero()) {
                this.addElement();
            }
            if (this.isMinSizeZero()) {
                this.isMinZeroReadOnly = true;
                this.addedFormZero.emit(true);
            }
        }
    }
    /**
     * @private
     * @return {?}
     */
    addElement() {
        /** @type {?} */
        const newForm = this.formBuilder.group({});
        this.form.push(newForm);
        this.addedForm.emit(newForm);
    }
    /**
     * @return {?}
     */
    clearAllElements() {
        this.resetFormIsMinSizeZero();
        while (this.form.length > 0) {
            this.form.removeAt(0);
        }
    }
    /**
     * @private
     * @return {?}
     */
    resetFormIsMinSizeZero() {
        if (this.isMinSizeZero()) {
            this.isMinZeroReadOnly = false;
            this.formSize.get('SIZE').reset();
        }
    }
    /**
     * @return {?}
     */
    isMaxSizeReached() {
        if (this.isMinZeroReadOnly) {
            return true;
        }
        return this.formSize.valid && this.size >= this.formSize.get('SIZE').value && this.formSize.get('SIZE').value > 0;
    }
    /**
     * @return {?}
     */
    get size() {
        return this.form.length;
    }
    /**
     * @return {?}
     */
    isMinSizeZero() {
        return this.minNumber == 0 && parseInt(this.formSize.get('SIZE').value, 10) === 0;
    }
}
RepeatFormComponent.decorators = [
    { type: Component, args: [{
                selector: 'anef-repeat-form',
                template: "<div>\n  <div class=\"p-grid form-element\" [ngClass]=\"{'on-error': !formSize.valid}\">\n    <div class=\"p-col-12 responsiv-md\">\n      <div class=\"p-col-fixed\">\n        <anef-input-text\n          class=\"amount\"\n          [required]=\"required\"\n          [readonly]=\"readOnly || isMaxSizeReached()\"\n          [formGroup]=\"formSize\"\n          [label]=\"inputNumberLabel\"\n          controlName=\"SIZE\"\n          [maxLength]= \"5\"\n          [messages]=\"{\n            required: 'Ce champ est obligatoire',\n            pattern: 'Le format n\\'est pas correct',\n            min: 'Le nombre de r\u00E9p\u00E9tition n\\'est pas assez grand',\n            max: 'Le nombre de r\u00E9p\u00E9tition est trop grand'\n          }\">\n        </anef-input-text>\n      </div>\n      <div>\n        <legend class=\"label\" *ngIf=\"size >= 1 && !readOnly || isMinSizeZero() && isMinZeroReadOnly && !readOnly\">\n          <span class=\"remove\" (click)=\"clearAllElements()\">\n            <i class=\"fa fa-close\" aria-hidden=\"true\"></i>\n            {{ removeLabel }}\n          </span>\n        </legend>\n      </div>\n\n    </div>\n\n    <div class=\"p-col-12\" *ngIf=\"!isMaxSizeReached() && !readOnly\">\n      <button pButton\n        label=\"{{ confirmLabel }}\"\n        (click)=\"confirmSize()\"\n        class=\"ui-button-secondary custom-responsiv\">\n      </button>\n    </div>\n  </div>\n\n  <div class=\"list-element p-grid wraper\" [ngClass]=\"{first: i==0, editable: !readOnly}\"\n    *ngFor=\"let subform of this.form['controls']; let i=index;\">\n    <fieldset class=\"full-width\">\n      <legend class=\"label\">\n        <ng-container *ngIf=\"header\">\n          {{ header }} {{i+1}}\n        </ng-container>\n      </legend>\n\n      <ng-container [ngTemplateOutlet]='template' [ngTemplateOutletContext]='{ $implicit: subform, idx: i  }'></ng-container>\n    </fieldset>\n  </div>\n</div>\n",
                styles: [".list-element{display:flex;flex-flow:row;flex-wrap:wrap;margin-top:0}.list-element .full-width{width:100%}.list-element .label{color:#417f90;font-size:1.2em;font-weight:700;padding:.5em}.list-element.editable .label{padding-top:.7em}.important{font-weight:700}.ui-button-secondary{background-color:#fff!important;color:#256cb9!important;border-color:#256cb9!important;text-align:center;margin:auto}fieldset legend{margin:0;padding:0;border:0}.remove{cursor:pointer;color:#d13721;font-size:1em;display:block;float:right;margin-top:-2.3em;position:relative;z-index:2}.remove .fa-close{font-weight:700;font-size:1em;margin-right:.4;margin-left:2em}::ng-deep .amount input,::ng-deep .amount span.textual{width:10em!important;display:block}::ng-deep .amount label{font-weight:200;width:100%}::ng-deep .amount .redish.errors.ng-star-inserted{width:100%}"]
            }] }
];
/** @nocollapse */
RepeatFormComponent.ctorParameters = () => [
    { type: FormGroupDirective },
    { type: FormBuilder }
];
RepeatFormComponent.propDecorators = {
    template: [{ type: ContentChild, args: [TemplateRef,] }],
    readOnly: [{ type: Input }],
    required: [{ type: Input }],
    maxNumber: [{ type: Input }],
    minNumber: [{ type: Input }],
    inputNumberLabel: [{ type: Input }],
    removeLabel: [{ type: Input }],
    confirmLabel: [{ type: Input }],
    errorMessages: [{ type: Input }],
    controlName: [{ type: Input }],
    header: [{ type: Input }],
    isFormTouched: [{ type: Input }],
    entreprisesSizeVide: [{ type: Input }],
    addedForm: [{ type: Output }],
    addedFormZero: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    RepeatFormComponent.prototype.template;
    /** @type {?} */
    RepeatFormComponent.prototype.readOnly;
    /** @type {?} */
    RepeatFormComponent.prototype.required;
    /** @type {?} */
    RepeatFormComponent.prototype.maxNumber;
    /** @type {?} */
    RepeatFormComponent.prototype.minNumber;
    /** @type {?} */
    RepeatFormComponent.prototype.inputNumberLabel;
    /** @type {?} */
    RepeatFormComponent.prototype.removeLabel;
    /** @type {?} */
    RepeatFormComponent.prototype.confirmLabel;
    /** @type {?} */
    RepeatFormComponent.prototype.errorMessages;
    /** @type {?} */
    RepeatFormComponent.prototype.controlName;
    /** @type {?} */
    RepeatFormComponent.prototype.header;
    /** @type {?} */
    RepeatFormComponent.prototype.isFormTouched;
    /** @type {?} */
    RepeatFormComponent.prototype.entreprisesSizeVide;
    /** @type {?} */
    RepeatFormComponent.prototype.addedForm;
    /** @type {?} */
    RepeatFormComponent.prototype.addedFormZero;
    /** @type {?} */
    RepeatFormComponent.prototype.numberRegexPattern;
    /** @type {?} */
    RepeatFormComponent.prototype.form;
    /** @type {?} */
    RepeatFormComponent.prototype.formSize;
    /** @type {?} */
    RepeatFormComponent.prototype.isMinZeroReadOnly;
    /**
     * @type {?}
     * @private
     */
    RepeatFormComponent.prototype.parentForm;
    /**
     * @type {?}
     * @private
     */
    RepeatFormComponent.prototype.formBuilder;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwZWF0LWZvcm0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vYW5lZi11aS8iLCJzb3VyY2VzIjpbImxpYi9mb3Jtcy9yZXBlYXQtZm9ybS9yZXBlYXQtZm9ybS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFxQixNQUFNLEVBQWlCLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNwSSxPQUFPLEVBQWEsV0FBVyxFQUFhLGtCQUFrQixFQUFFLFVBQVUsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBT25HLE1BQU0sT0FBTyxtQkFBbUI7Ozs7O0lBOEI5QixZQUFvQixVQUE4QixFQUM5QixXQUF3QjtRQUR4QixlQUFVLEdBQVYsVUFBVSxDQUFvQjtRQUM5QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQTdCbkMsYUFBUSxHQUFHLEtBQUssQ0FBQztRQUNqQixhQUFRLEdBQUcsSUFBSSxDQUFDO1FBRWhCLGNBQVMsR0FBVyxDQUFDLENBQUM7UUFDdEIscUJBQWdCLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLGdCQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ2pCLGlCQUFZLEdBQUcsRUFBRSxDQUFDO1FBQ2xCLGtCQUFhLEdBQUc7WUFDdkIsUUFBUSxFQUFFLDBCQUEwQjtZQUNwQyxPQUFPLEVBQUUsOEJBQThCO1lBQ3ZDLEdBQUcsRUFBRSxnREFBZ0Q7WUFDckQsR0FBRyxFQUFFLHdDQUF3QztTQUM5QyxDQUFDO1FBRU8sV0FBTSxHQUFHLEVBQUUsQ0FBQztRQUNaLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLHdCQUFtQixHQUFZLEtBQUssQ0FBQztRQUVwQyxjQUFTLEdBQTRCLElBQUksWUFBWSxFQUFhLENBQUM7UUFDbkUsa0JBQWEsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUdoRSx1QkFBa0IsR0FBVyxPQUFPLENBQUM7UUFJ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bXBvcnQgeyBDb21wb25lbnQsIENvbnRlbnRDaGlsZCwgRXZlbnRFbWl0dGVyLCBJbnB1dCwgT25DaGFuZ2VzLCBPbkluaXQsIE91dHB1dCwgU2ltcGxlQ2hhbmdlcywgVGVtcGxhdGVSZWYgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1BcnJheSwgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCwgRm9ybUdyb3VwRGlyZWN0aXZlLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdhbmVmLXJlcGVhdC1mb3JtJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3JlcGVhdC1mb3JtLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vcmVwZWF0LWZvcm0uY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBSZXBlYXRGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICBAQ29udGVudENoaWxkKFRlbXBsYXRlUmVmKSB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgcmVhZE9ubHkgPSBmYWxzZTtcbiAgQElucHV0KCkgcmVxdWlyZWQgPSB0cnVlO1xuICBASW5wdXQoKSBtYXhOdW1iZXI6IG51bWJlcjtcbiAgQElucHV0KCkgbWluTnVtYmVyOiBudW1iZXIgPSAxO1xuICBASW5wdXQoKSBpbnB1dE51bWJlckxhYmVsID0gJyc7XG4gIEBJbnB1dCgpIHJlbW92ZUxhYmVsID0gJyc7XG4gIEBJbnB1dCgpIGNvbmZpcm1MYWJlbCA9ICcnO1xuICBASW5wdXQoKSBlcnJvck1lc3NhZ2VzID0ge1xuICAgIHJlcXVpcmVkOiAnQ2UgY2hhbXAgZXN0IG9ibGlnYXRvaXJlJyxcbiAgICBwYXR0ZXJuOiAnTGUgZm9ybWF0IG5cXCdlc3QgcGFzIGNvcnJlY3QnLFxuICAgIG1pbjogJ0xlIG5vbWJyZSBkZSByw6lww6l0aXRpb24gblxcJ2VzdCBwYXMgYXNzZXogZ3JhbmQnLFxuICAgIG1heDogJ0xlIG5vbWJyZSBkZSByw6lww6l0aXRpb24gZXN0IHRyb3AgZ3JhbmQnXG4gIH07XG4gIEBJbnB1dCgpIGNvbnRyb2xOYW1lOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGhlYWRlciA9ICcnO1xuICBASW5wdXQoKSBpc0Zvcm1Ub3VjaGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIGVudHJlcHJpc2VzU2l6ZVZpZGU6IGJvb2xlYW4gPSBmYWxzZTtcblxuICBAT3V0cHV0KCkgYWRkZWRGb3JtOiBFdmVudEVtaXR0ZXI8Rm9ybUdyb3VwPiA9IG5ldyBFdmVudEVtaXR0ZXI8Rm9ybUdyb3VwPigpO1xuICBAT3V0cHV0KCkgYWRkZWRGb3JtWmVybzogRXZlbnRFbWl0dGVyPGFueT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gXG5cbiAgbnVtYmVyUmVnZXhQYXR0ZXJuOiBSZWdFeHAgPSAvXlxcZCskLztcblxuICBmb3JtOiBGb3JtQXJyYXk7XG4gIGZvcm1TaXplOiBGb3JtR3JvdXA7XG4gIGlzTWluWmVyb1JlYWRPbmx5OiBib29sZWFuID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBwYXJlbnRGb3JtOiBGb3JtR3JvdXBEaXJlY3RpdmUsXG4gICAgICAgICAgICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyKSB7IH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLmluaXRGb3JtKCk7XG4gICAgdGhpcy5wYXRjaEZvcm0oKTtcbiAgICB0aGlzLnBhdGNoRm9ybVNpemVWaWRlKCk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNGb3JtVG91Y2hlZCkge1xuICAgICAgdGhpcy5mb3JtU2l6ZS5jb250cm9sc1snU0laRSddLm1hcmtBc1RvdWNoZWQoKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaW5pdEZvcm0oKSB7XG4gICAgdGhpcy5mb3JtID0gdGhpcy5wYXJlbnRGb3JtLmZvcm0uZ2V0KHRoaXMuY29udHJvbE5hbWUpIGFzIEZvcm1BcnJheTtcbiAgICBjb25zdCB2YWxpZGF0b3JzID0gdGhpcy5idWlsZFNpemVWYWxpZGF0b3JzKCk7XG4gICAgdGhpcy5mb3JtU2l6ZSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgU0laRTogWycnLCB2YWxpZGF0b3JzXVxuICAgIH0pO1xuICAgIGlmICh0aGlzLnJlYWRPbmx5KSB7XG4gICAgICB0aGlzLmZvcm1TaXplLmRpc2FibGUoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHBhdGNoRm9ybSgpIHtcbiAgICBjb25zdCBpbml0aWFsRm9ybVNpemUgPSB0aGlzLmZvcm0ubGVuZ3RoID09PSAwID8gJycgOiB0aGlzLmZvcm0ubGVuZ3RoO1xuICAgIHRoaXMuZm9ybVNpemUuZ2V0KCdTSVpFJykuc2V0VmFsdWUoaW5pdGlhbEZvcm1TaXplKTtcbiAgICBpZiAoaW5pdGlhbEZvcm1TaXplKSB7XG4gICAgICB0aGlzLmNvbmZpcm1TaXplKCk7XG4gICAgfSBcbiAgfVxuXG4gIHByaXZhdGUgcGF0Y2hGb3JtU2l6ZVZpZGUoKSB7XG4gICAgaWYgKHRoaXMubWluTnVtYmVyID09IDAgJiYgdGhpcy5lbnRyZXByaXNlc1NpemVWaWRlKSB7XG4gICAgICBjb25zdCBpbml0aWFsRm9ybVNpemUgPSB0aGlzLmZvcm0ubGVuZ3RoO1xuICAgICAgdGhpcy5mb3JtU2l6ZS5nZXQoJ1NJWkUnKS5zZXRWYWx1ZSgnMCcpO1xuICAgICAgdGhpcy5pc01pblplcm9SZWFkT25seSA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBidWlsZFNpemVWYWxpZGF0b3JzKCk6IFZhbGlkYXRvcnNbXSB7XG4gICAgbGV0IHZhbGlkYXRvcnM6IFZhbGlkYXRvcnNbXSA9IFtWYWxpZGF0b3JzLnBhdHRlcm4odGhpcy5udW1iZXJSZWdleFBhdHRlcm4pXTtcbiAgICBpZiAodGhpcy5yZXF1aXJlZCkge1xuICAgICAgdmFsaWRhdG9ycy5wdXNoKFZhbGlkYXRvcnMucmVxdWlyZWQpO1xuICAgIH1cbiAgICBpZiAodGhpcy5taW5OdW1iZXIpIHtcbiAgICAgIHZhbGlkYXRvcnMucHVzaChWYWxpZGF0b3JzLm1pbih0aGlzLm1pbk51bWJlcikpO1xuICAgIH0gXG4gICAgaWYgKHRoaXMubWF4TnVtYmVyICYmIHRoaXMubWF4TnVtYmVyID4gMCkge1xuICAgICAgdmFsaWRhdG9ycy5wdXNoKFZhbGlkYXRvcnMubWF4KHRoaXMubWF4TnVtYmVyKSk7XG4gICAgfVxuICAgIHJldHVybiB2YWxpZGF0b3JzO1xuICB9XG5cbiAgY29uZmlybVNpemUoKSB7XG4gICAgdGhpcy5mb3JtU2l6ZS5nZXQoJ1NJWkUnKS5tYXJrQXNUb3VjaGVkKCk7XG4gICAgaWYgKHRoaXMuZm9ybVNpemUudmFsaWQpIHtcbiAgICAgIHdoaWxlKCEgdGhpcy5pc01heFNpemVSZWFjaGVkKCkgJiYgIXRoaXMuaXNNaW5TaXplWmVybygpKSB7XG4gICAgICAgIHRoaXMuYWRkRWxlbWVudCgpO1xuICAgICAgfVxuXG4gICAgICBpZiAodGhpcy5pc01pblNpemVaZXJvKCkpIHtcbiAgICAgICAgdGhpcy5pc01pblplcm9SZWFkT25seSA9IHRydWU7XG4gICAgICAgIHRoaXMuYWRkZWRGb3JtWmVyby5lbWl0KHRydWUpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYWRkRWxlbWVudCgpIHtcbiAgICBjb25zdCBuZXdGb3JtID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cCh7fSk7XG4gICAgdGhpcy5mb3JtLnB1c2gobmV3Rm9ybSk7XG4gICAgdGhpcy5hZGRlZEZvcm0uZW1pdChuZXdGb3JtKTtcbiAgfVxuXG4gIGNsZWFyQWxsRWxlbWVudHMoKSB7XG4gICAgdGhpcy5yZXNldEZvcm1Jc01pblNpemVaZXJvKCk7XG4gICAgd2hpbGUgKHRoaXMuZm9ybS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLmZvcm0ucmVtb3ZlQXQoMCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZXNldEZvcm1Jc01pblNpemVaZXJvKCkge1xuICAgIGlmICh0aGlzLmlzTWluU2l6ZVplcm8oKSkge1xuICAgICAgdGhpcy5pc01pblplcm9SZWFkT25seSA9IGZhbHNlO1xuICAgICAgdGhpcy5mb3JtU2l6ZS5nZXQoJ1NJWkUnKS5yZXNldCgpO1xuICAgIH1cbiAgfVxuXG4gIGlzTWF4U2l6ZVJlYWNoZWQoKTogYm9vbGVhbiB7XG4gICAgaWYgKHRoaXMuaXNNaW5aZXJvUmVhZE9ubHkpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5mb3JtU2l6ZS52YWxpZCAmJiB0aGlzLnNpemUgPj0gdGhpcy5mb3JtU2l6ZS5nZXQoJ1NJWkUnKS52YWx1ZSAmJiB0aGlzLmZvcm1TaXplLmdldCgnU0laRScpLnZhbHVlID4gMDtcbiAgfVxuXG4gIGdldCBzaXplKCkge1xuICAgIHJldHVybiB0aGlzLmZvcm0ubGVuZ3RoO1xuICB9XG5cbiAgaXNNaW5TaXplWmVybygpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5taW5OdW1iZXIgPT0gMCAmJiBwYXJzZUludCh0aGlzLmZvcm1TaXplLmdldCgnU0laRScpLnZhbHVlLCAxMCkgPT09IDA7XG4gIH1cbn1cbiJdfQ==