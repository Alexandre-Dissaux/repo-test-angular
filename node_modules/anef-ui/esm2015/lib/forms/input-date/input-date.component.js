/**
 * @fileoverview added by tsickle
 * Generated from: lib/forms/input-date/input-date.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
// Angular
import { Component, Input } from '@angular/core';
import { FormGroup } from '@angular/forms';
import { merge, Subject } from 'rxjs';
import { debounceTime, takeUntil } from 'rxjs/operators';
import moment from 'moment';
export class InputDateComponent {
    constructor() {
        this.notifier = new Subject();
        this.unknownMonthItem = { label: 'Inconnu', value: 'i' };
        this.required = false;
        this.readonly = false;
        this.defaultDisplay = 'N/A';
        this.dayLabel = 'Jour';
        this.dayPlaceholder = 'JJ';
        this.monthLabel = 'Mois';
        this.monthPlaceholder = 'MM';
        this.yearLabel = 'Année';
        this.yearPlaceholder = 'AAAA';
        this.monthOptions = [
            { label: 'Janvier', value: 1 },
            { label: 'Février', value: 2 },
            { label: 'Mars', value: 3 },
            { label: 'Avril', value: 4 },
            { label: 'Mai', value: 5 },
            { label: 'Juin', value: 6 },
            { label: 'Juillet', value: 7 },
            { label: 'Août', value: 8 },
            { label: 'Septembre', value: 9 },
            { label: 'Octobre', value: 10 },
            { label: 'Novembre', value: 11 },
            { label: 'Décembre', value: 12 }
        ];
        this.messages = {
            day: {
                required: 'Le jour est requis',
                pattern: 'Le jour doit être un nombre',
                length: 'Le jour doit contenir 2 chiffres au maximum',
                minMax: 'Le jour doit être compris entre 1 et 31'
            },
            month: {
                required: 'Le mois est requis'
            },
            year: {
                required: 'L\'année est requise',
                pattern: 'L\'année doit être un nombre',
                length: 'L\'année doit contenir 4 chiffres'
            },
            invalid: 'La date est invalide'
        };
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        /** @type {?} */
        const dayChanges = this.formGroup.get(this.dayName).valueChanges;
        /** @type {?} */
        const monthChanges = this.formGroup.get(this.monthName).valueChanges;
        /** @type {?} */
        const yearChanges = this.formGroup.get(this.yearName).valueChanges;
        this.dateChanges = merge(dayChanges, monthChanges, yearChanges);
        this.dateValidityChange();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.notifier.next();
        this.notifier.unsubscribe();
    }
    /**
     * @return {?}
     */
    formContainsErrors() {
        return (this.controlContainsErrors(this.dayName) ||
            this.controlContainsErrors(this.monthName) ||
            this.controlContainsErrors(this.yearName));
    }
    /**
     * @param {?} controlName
     * @return {?}
     */
    controlContainsErrors(controlName) {
        return this.formGroup && (this.formGroup.controls[controlName].errors !== null && this.formGroup.controls[controlName].dirty);
    }
    /**
     * @param {?} controlName
     * @return {?}
     */
    hasPatternError(controlName) {
        return this.controlContainsErrors(controlName) && this.formGroup.controls[controlName].errors.pattern;
    }
    /**
     * @param {?} controlName
     * @return {?}
     */
    hasMinMaxError(controlName) {
        return this.controlContainsErrors(controlName) &&
            (this.formGroup.controls[controlName].errors.min || this.formGroup.controls[controlName].errors.max);
    }
    /**
     * @param {?} controlName
     * @return {?}
     */
    hasLengthError(controlName) {
        return this.controlContainsErrors(controlName) &&
            (this.formGroup.controls[controlName].errors.minlength || this.formGroup.controls[controlName].errors.maxlength);
    }
    /**
     * @param {?} controlName
     * @return {?}
     */
    hasRequiredError(controlName) {
        return this.controlContainsErrors(controlName) && this.formGroup.controls[controlName].errors.required;
    }
    /**
     * @param {?} controlName
     * @return {?}
     */
    hasInvalidDateError(controlName) {
        return this.controlContainsErrors(controlName) && this.formGroup.controls[controlName].errors.invalidDate;
    }
    /**
     * @return {?}
     */
    dateValidityChange() {
        this.dateChanges.pipe(debounceTime(200), takeUntil(this.notifier)).subscribe((/**
         * @return {?}
         */
        () => {
            this.resetErrors();
            /** @type {?} */
            const day = Number(this.formGroup.get(this.dayName).value);
            /** @type {?} */
            const month = this.formGroup.get(this.monthName).value - 1;
            /** @type {?} */
            const year = Number(this.formGroup.get(this.yearName).value);
            this.checkDateValidity(day, month, year);
        }));
    }
    /**
     * @private
     * @return {?}
     */
    getFields() {
        return { day: this.formGroup.get(this.dayName).value, month: this.getMonthValue(true), year: this.formGroup.get(this.yearName).value };
    }
    /**
     * Returns FormGroup month field value
     * @private
     * @param {?=} correctForMoment
     * @return {?}
     */
    getMonthValue(correctForMoment) {
        /** @type {?} */
        let value = this.formGroup.get(this.monthName).value;
        if (value === this.unknownMonthItem.value) {
            value = 1;
        }
        if (correctForMoment) {
            return value - 1;
        }
        return value;
    }
    /**
     * @return {?}
     */
    areFieldsFilled() {
        /** @type {?} */
        const fields = this.getFields();
        return fields.day != null && fields.month != -1 && fields.year != null;
    }
    /**
     * @param {?} day
     * @param {?} month
     * @param {?} year
     * @return {?}
     */
    checkDateValidity(day, month, year) {
        /** @type {?} */
        const fields = this.getFields();
        if (this.areFieldsFilled() && !moment([year, month, day]).isValid()) {
            this.formGroup.get(this.yearName).setErrors({ invalidDate: true }, { emitEvent: true });
            this.formGroup.get(this.monthName).setErrors({ invalidDate: true }, { emitEvent: true });
            this.formGroup.get(this.dayName).setErrors({ invalidDate: true }, { emitEvent: true });
            this.formGroup.setErrors({ invalidDate: true }, { emitEvent: true });
            if ((this.required || this.yearRequired) && this.areFieldsFilled()) {
                return { invalidDate: true };
            }
        }
        if (moment([fields.year, fields.month, fields.day]).isValid()) {
            this.formGroup.setErrors(null);
            this.formGroup.get(this.yearName).setErrors(null);
            this.formGroup.get(this.monthName).setErrors(null);
            this.formGroup.get(this.dayName).setErrors(null);
        }
        return null;
    }
    /**
     * @private
     * @return {?}
     */
    resetErrors() {
        this.formGroup.get(this.dayName).setErrors(null);
        this.formGroup.get(this.monthName).setErrors(null);
        this.formGroup.get(this.yearName).setErrors(null);
    }
    /**
     * @return {?}
     */
    toString() {
        /** @type {?} */
        let result = '';
        /** @type {?} */
        const day = Number(this.formGroup.get(this.dayName).value);
        result += day ? ('0' + day).slice(-2) + '/' : '';
        /** @type {?} */
        const month = Number(this.formGroup.get(this.monthName).value);
        result += month ? ('0' + month).slice(-2) + '/' : '';
        /** @type {?} */
        const year = Number(this.formGroup.get(this.yearName).value);
        result += year;
        return result === '0' ? this.defaultDisplay : result;
    }
}
InputDateComponent.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line: component-selector
                selector: 'anef-input-date',
                template: "<div class=\"p-grid nogutter\" [formGroup]=\"formGroup\">\n  <div class=\"p-col-12\">\n    <fieldset>\n      <legend *ngIf=\"label\">\n        {{ label }} <span class=\"redish\" *ngIf=\"required\">*</span> :\n      </legend>\n\n      <ng-content select=\"[sub-label]\"></ng-content>\n\n      <div *ngIf=\"!readonly; else textual\" class=\"p-grid\">\n        <div class=\"p-col-12 p-md-2\">\n          <div class=\"p-grid nogutter\">\n            <div class=\"p-col-12\">\n              <label id=\"dayHelpBlock\">{{ dayLabel }} :\n              </label>\n              <input pInputText [id]=\"dayName\" [name]=\"dayName\" type=\"text\" class=\"day\"\n                     placeholder=\"{{ dayPlaceholder}}\" aria-describedby=\"dayHelpBlock\"\n                     [formControlName]=\"dayName\" pattern=\"[0-9]{0,2}\" maxlength=\"2\">\n            </div>\n          </div>\n        </div>\n        <div class=\"p-col-12 p-md-6\">\n          <div class=\"p-grid nogutter\">\n            <div class=\"p-col-12\">\n              <label id=\"monthHelpBlock\">{{ monthLabel }} :\n              </label>\n              <p-dropdown class=\"month-dropdown\" [id]=\"monthName\" [name]=\"monthName\" aria-describedby=\"monthHelpBlock\"\n                          [placeholder]=monthPlaceholder [options]=monthOptions\n                          [formControlName]=\"monthName\">\n              </p-dropdown>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"p-col-12 p-md-4\">\n          <div class=\"p-grid nogutter\">\n            <div class=\"p-col-12\">\n              <label id=\"yearHelpBlock\">{{ yearLabel}}\n                <span class=\"redish\" *ngIf=\"yearRequired\"> *</span> :\n              </label>\n              <input pInputText [id]=\"yearName\" [name]=\"yearName\" type=\"text\" placeholder=\"{{ yearPlaceholder }}\"\n                     pattern=\"[0-9]{0,4}\" minlength=\"4\" maxlength=\"4\"\n                     aria-describedby=\"yearHelpBlock\" [formControlName]=\"yearName\">\n            </div>\n          </div>\n        </div>\n      </div>\n      <ng-template #textual>\n        <span class=\"textual\">{{toString()}}</span>\n      </ng-template>\n\n      <ng-content select=\"[complement]\"></ng-content>\n\n      <div class=\"redish errors\" *ngIf=\"formContainsErrors()\">\n        <div *ngIf=\"controlContainsErrors(dayName)\">\n          <div *ngIf=\"hasPatternError(dayName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.day.pattern}}\n            </span>\n          </div>\n          <div *ngIf=\"hasMinMaxError(dayName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.day.minMax}}\n            </span>\n          </div>\n          <div *ngIf=\"hasLengthError(dayName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.day.length}}\n            </span>\n          </div>\n          <div *ngIf=\"hasRequiredError(dayName) && !hasPatternError(dayName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.day.required}}\n            </span>\n          </div>\n        </div>\n        <div *ngIf=\"controlContainsErrors(monthName)\">\n          <div *ngIf=\"hasRequiredError(monthName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.month.required}}\n            </span>\n          </div>\n        </div>\n        <div *ngIf=\"controlContainsErrors(yearName)\">\n          <div *ngIf=\"hasPatternError(yearName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.year.pattern}}\n            </span>\n          </div>\n          <div *ngIf=\"hasLengthError(yearName) && !hasPatternError(yearName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.year.length}}\n            </span>\n          </div>\n          <div *ngIf=\"hasRequiredError(yearName) && !hasPatternError(yearName)\">\n            <i class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n            <span>\n              {{messages.year.required}}\n            </span>\n          </div>\n        </div>\n\n        <div *ngIf=\"hasInvalidDateError(dayName) || hasInvalidDateError(monthName) || hasInvalidDateError(yearName)\"><i\n          class=\"fa fa-exclamation-circle\" aria-hidden=\"true\"></i>\n          <span>\n              {{messages.invalid}}\n          </span>\n        </div>\n\n        <ng-content select=\"[messages]\"></ng-content>\n      </div>\n    </fieldset>\n  </div>\n</div>\n",
                styles: [".textual{display:block}.day{padding-left:1rem;padding-right:1rem;min-width:4rem}#dayHelpBlock{white-space:nowrap}fieldset{border-color:transparent;border-width:0;padding:0}legend{-webkit-padding-start:0;padding-inline-start:0;padding-bottom:1rem}.p-grid label{margin:0;color:#656565}body .ui-dropdown-panel .ui-dropdown-items .ui-dropdown-item span:first{color:#656565}::-webkit-input-placeholder{color:#111}:-moz-placeholder{color:#111}::-moz-placeholder{color:#111}:-ms-input-placeholder{color:#111}"]
            }] }
];
/** @nocollapse */
InputDateComponent.ctorParameters = () => [];
InputDateComponent.propDecorators = {
    formGroup: [{ type: Input }],
    label: [{ type: Input }],
    required: [{ type: Input }],
    readonly: [{ type: Input }],
    defaultDisplay: [{ type: Input }],
    dayName: [{ type: Input }],
    dayLabel: [{ type: Input }],
    dayPlaceholder: [{ type: Input }],
    monthName: [{ type: Input }],
    monthLabel: [{ type: Input }],
    monthPlaceholder: [{ type: Input }],
    yearName: [{ type: Input }],
    yearRequired: [{ type: Input }],
    yearLabel: [{ type: Input }],
    yearPlaceholder: [{ type: Input }],
    model: [{ type: Input }],
    monthOptions: [{ type: Input }],
    messages: [{ type: Input }]
};
if (false) {
    /**
     * @type {?}
     * @private
     */
    InputDateComponent.prototype.notifier;
    /**
     * @type {?}
     * @private
     */
    InputDateComponent.prototype.dateChanges;
    /**
     * @type {?}
     * @private
     */
    InputDateComponent.prototype.unknownMonthItem;
    /** @type {?} */
    InputDateComponent.prototype.formGroup;
    /** @type {?} */
    InputDateComponent.prototype.label;
    /** @type {?} */
    InputDateComponent.prototype.required;
    /** @type {?} */
    InputDateComponent.prototype.readonly;
    /** @type {?} */
    InputDateComponent.prototype.defaultDisplay;
    /** @type {?} */
    InputDateComponent.prototype.dayName;
    /** @type {?} */
    InputDateComponent.prototype.dayLabel;
    /** @type {?} */
    InputDateComponent.prototype.dayPlaceholder;
    /** @type {?} */
    InputDateComponent.prototype.monthName;
    /** @type {?} */
    InputDateComponent.prototype.monthLabel;
    /** @type {?} */
    InputDateComponent.prototype.monthPlaceholder;
    /** @type {?} */
    InputDateComponent.prototype.yearName;
    /** @type {?} */
    InputDateComponent.prototype.yearRequired;
    /** @type {?} */
    InputDateComponent.prototype.yearLabel;
    /** @type {?} */
    InputDateComponent.prototype.yearPlaceholder;
    /** @type {?} */
    InputDateComponent.prototype.model;
    /** @type {?} */
    InputDateComponent.prototype.monthOptions;
    /** @type {?} */
    InputDateComponent.prototype.messages;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5wdXQtZGF0ZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmVmLXVpLyIsInNvdXJjZXMiOlsibGliL2Zvcm1zL2lucHV0LWRhdGUvaW5wdXQtZGF0ZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQ0EsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQXFCLE1BQU0sZUFBZSxDQUFDO0FBQ3BFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUczQyxPQUFPLEVBQUUsS0FBSyxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUNsRCxPQUFPLEVBQVUsWUFBWSxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2pFLE9BQU8sTUFBTSxNQUFNLFFBQVEsQ0FBQztBQVE1QixNQUFNLE9BQU8sa0JBQWtCO0lBcUQ3QjtRQXBEUSxhQUFRLEdBQWlCLElBQUksT0FBTyxFQUFFLENBQUM7UUFFdkMscUJBQWdCLEdBQUcsRUFBQyxLQUFLLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUMsQ0FBQztRQUdqRCxhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsbUJBQWMsR0FBRyxLQUFLLENBQUM7UUFHdkIsYUFBUSxHQUFHLE1BQU0sQ0FBQztRQUNsQixtQkFBYyxHQUFHLElBQUksQ0FBQztRQUV0QixlQUFVLEdBQUcsTUFBTSxDQUFDO1FBQ3BCLHFCQUFnQixHQUFHLElBQUksQ0FBQztRQUd4QixjQUFTLEdBQUcsT0FBTyxDQUFDO1FBQ3BCLG9CQUFlLEdBQUcsTUFBTSxDQUFDO1FBRXpCLGlCQUFZLEdBQWlCO1lBQ3BDLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQzlCLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQzlCLEVBQUUsS0FB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QUFLO3VCQWNMLEtBQUs7Ozs7Ozs7SUFsQ04sc0NBQStDOzs7OztJQUMvQyx5Q0FBcUM7Ozs7O0lBQ3JDLDhDQUEwRDs7SUFDMUQsdUNBQThCOztJQUM5QixtQ0FBdUI7O0lBQ3ZCLHNDQUEwQjs7SUFDMUIsc0NBQTBCOztJQUMxQiw0Q0FBZ0M7O0lBRWhDLHFDQUF5Qjs7SUFDekIsc0NBQTJCOztJQUMzQiw0Q0FBK0I7O0lBQy9CLHVDQUEyQjs7SUFDM0Isd0NBQTZCOztJQUM3Qiw4Q0FBaUM7O0lBQ2pDLHNDQUEwQjs7SUFDMUIsMENBQStCOztJQUMvQix1Q0FBNkI7O0lBQzdCLDZDQUFrQzs7SUFDbEMsbUNBQW9COztJQUNwQiwwQ0FhRTs7SUFDRixzQ0FnQkUiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBbmd1bGFyXG5pbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgU2VsZWN0SXRlbSB9IGZyb20gJ3ByaW1lbmcvYXBpJztcbmltcG9ydCB7IERhdGVFcnJvck1lc3NhZ2UgfSBmcm9tICcuLi9tb2RlbHMvZGF0ZS1lcnJvci1tZXNzYWdlJztcbmltcG9ydCB7IG1lcmdlLCBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBmaWx0ZXIsIGRlYm91bmNlVGltZSwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IG1vbWVudCBmcm9tICdtb21lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOiBjb21wb25lbnQtc2VsZWN0b3JcbiAgc2VsZWN0b3I6ICdhbmVmLWlucHV0LWRhdGUnLFxuICB0ZW1wbGF0ZVVybDogJy4vaW5wdXQtZGF0ZS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2lucHV0LWRhdGUuY29tcG9uZW50LnNjc3MnXSxcbn0pXG5leHBvcnQgY2xhc3MgSW5wdXREYXRlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBwcml2YXRlIG5vdGlmaWVyOiBTdWJqZWN0PGFueT4gPSBuZXcgU3ViamVjdCgpO1xuICBwcml2YXRlIGRhdGVDaGFuZ2VzOiBPYnNlcnZhYmxlPGFueT47XG4gIHByaXZhdGUgdW5rbm93bk1vbnRoSXRlbSA9IHtsYWJlbDogJ0luY29ubnUnLCB2YWx1ZTogJ2knfTtcbiAgQElucHV0KCkgZm9ybUdyb3VwOiBGb3JtR3JvdXA7XG4gIEBJbnB1dCgpIGxhYmVsOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHJlcXVpcmVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIHJlYWRvbmx5ID0gZmFsc2U7XG4gIEBJbnB1dCgpIGRlZmF1bHREaXNwbGF5ID0gJ04vQSc7XG5cbiAgQElucHV0KCkgZGF5TmFtZTogc3RyaW5nO1xuICBASW5wdXQoKSBkYXlMYWJlbCA9ICdKb3VyJztcbiAgQElucHV0KCkgZGF5UGxhY2Vob2xkZXIgPSAnSkonO1xuICBASW5wdXQoKSBtb250aE5hbWU6IHN0cmluZztcbiAgQElucHV0KCkgbW9udGhMYWJlbCA9ICdNb2lzJztcbiAgQElucHV0KCkgbW9udGhQbGFjZWhvbGRlciA9ICdNTSc7XG4gIEBJbnB1dCgpIHllYXJOYW1lOiBzdHJpbmc7XG4gIEBJbnB1dCgpIHllYXJSZXF1aXJlZDogYm9vbGVhbjtcbiAgQElucHV0KCkgeWVhckxhYmVsID0gJ0FubsOpZSc7XG4gIEBJbnB1dCgpIHllYXJQbGFjZWhvbGRlciA9ICdBQUFBJztcbiAgQElucHV0KCkgbW9kZWw6IGFueTtcbiAgQElucHV0KCkgbW9udGhPcHRpb25zOiBTZWxlY3RJdGVtW10gPSBbXG4gICAgeyBsYWJlbDogJ0phbnZpZXInLCB2YWx1ZTogMSB9LFxuICAgIHsgbGFiZWw6ICdGw6l2cmllcicsIHZhbHVlOiAyIH0sXG4gICAgeyBsYWJlbDogJ01hcnMnLCB2YWx1ZTogMyB9LFxuICAgIHsgbGFiZWw6ICdBdnJpbCcsIHZhbHVlOiA0IH0sXG4gICAgeyBsYWJlbDogJ01haScsIHZhbHVlOiA1IH0sXG4gICAgeyBsYWJlbDogJ0p1aW4nLCB2YWx1ZTogNiB9LFxuICAgIHsgbGFiZWw6ICdKdWlsbGV0JywgdmFsdWU6IDcgfSxcbiAgICB7IGxhYmVsOiAnQW/Du3QnLCB2YWx1ZTogOCB9LFxuICAgIHsgbGFiZWw6ICdTZXB0ZW1icmUnLCB2YWx1ZTogOSB9LFxuICAgIHsgbGFiZWw6ICdPY3RvYnJlJywgdmFsdWU6IDEwIH0sXG4gICAgeyBsYWJlbDogJ05vdmVtYnJlJywgdmFsdWU6IDExIH0sXG4gICAgeyBsYWJlbDogJ0TDqWNlbWJyZScsIHZhbHVlOiAxMiB9XG4gIF07XG4gIEBJbnB1dCgpIG1lc3NhZ2VzOiBEYXRlRXJyb3JNZXNzYWdlID0ge1xuICAgIGRheToge1xuICAgICAgcmVxdWlyZWQ6ICdMZSBqb3VyIGVzdCByZXF1aXMnLFxuICAgICAgcGF0dGVybjogJ0xlIGpvdXIgZG9pdCDDqnRyZSB1biBub21icmUnLFxuICAgICAgbGVuZ3RoOiAnTGUgam91ciBkb2l0IGNvbnRlbmlyIDIgY2hpZmZyZXMgYXUgbWF4aW11bScsXG4gICAgICBtaW5NYXg6ICdMZSBqb3VyIGRvaXQgw6p0cmUgY29tcHJpcyBlbnRyZSAxIGV0IDMxJ1xuICAgIH0sXG4gICAgbW9udGg6IHtcbiAgICAgIHJlcXVpcmVkOiAnTGUgbW9pcyBlc3QgcmVxdWlzJ1xuICAgIH0sXG4gICAgeWVhcjoge1xuICAgICAgcmVxdWlyZWQ6ICdMXFwnYW5uw6llIGVzdCByZXF1aXNlJyxcbiAgICAgIHBhdHRlcm46ICdMXFwnYW5uw6llIGRvaXQgw6p0cmUgdW4gbm9tYnJlJyxcbiAgICAgIGxlbmd0aDogJ0xcXCdhbm7DqWUgZG9pdCBjb250ZW5pciA0IGNoaWZmcmVzJ1xuICAgIH0sXG4gICAgaW52YWxpZDogJ0xhIGRhdGUgZXN0IGludmFsaWRlJ1xuICB9O1xuXG4gIGNvbnN0cnVjdG9yKCkgeyB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgY29uc3QgZGF5Q2hhbmdlcyA9IHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLmRheU5hbWUpLnZhbHVlQ2hhbmdlcztcbiAgICBjb25zdCBtb250aENoYW5nZXMgPSB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5tb250aE5hbWUpLnZhbHVlQ2hhbmdlcztcbiAgICBjb25zdCB5ZWFyQ2hhbmdlcyA9IHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLnllYXJOYW1lKS52YWx1ZUNoYW5nZXM7XG4gICAgdGhpcy5kYXRlQ2hhbmdlcyA9IG1lcmdlKGRheUNoYW5nZXMsIG1vbnRoQ2hhbmdlcywgeWVhckNoYW5nZXMpO1xuICAgIHRoaXMuZGF0ZVZhbGlkaXR5Q2hhbmdlKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLm5vdGlmaWVyLm5leHQoKTtcbiAgICB0aGlzLm5vdGlmaWVyLnVuc3Vic2NyaWJlKCk7XG4gIH1cblxuICBmb3JtQ29udGFpbnNFcnJvcnMoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIChcbiAgICAgIHRoaXMuY29udHJvbENvbnRhaW5zRXJyb3JzKHRoaXMuZGF5TmFtZSkgfHxcbiAgICAgIHRoaXMuY29udHJvbENvbnRhaW5zRXJyb3JzKHRoaXMubW9udGhOYW1lKSB8fFxuICAgICAgdGhpcy5jb250cm9sQ29udGFpbnNFcnJvcnModGhpcy55ZWFyTmFtZSlcbiAgICApO1xuICB9XG5cbiAgY29udHJvbENvbnRhaW5zRXJyb3JzKGNvbnRyb2xOYW1lKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuZm9ybUdyb3VwICYmICh0aGlzLmZvcm1Hcm91cC5jb250cm9sc1tjb250cm9sTmFtZV0uZXJyb3JzICE9PSBudWxsICYmIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5kaXJ0eSk7XG4gIH1cblxuICBoYXNQYXR0ZXJuRXJyb3IoY29udHJvbE5hbWUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb250cm9sQ29udGFpbnNFcnJvcnMoY29udHJvbE5hbWUpICYmIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5lcnJvcnMucGF0dGVybjtcbiAgfVxuXG4gIGhhc01pbk1heEVycm9yKGNvbnRyb2xOYW1lKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJvbENvbnRhaW5zRXJyb3JzKGNvbnRyb2xOYW1lKSAmJlxuICAgICAgKHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5lcnJvcnMubWluIHx8IHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5lcnJvcnMubWF4KTtcbiAgfVxuXG4gIGhhc0xlbmd0aEVycm9yKGNvbnRyb2xOYW1lKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJvbENvbnRhaW5zRXJyb3JzKGNvbnRyb2xOYW1lKSAmJlxuICAgICAgKHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5lcnJvcnMubWlubGVuZ3RoIHx8IHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5lcnJvcnMubWF4bGVuZ3RoKTtcbiAgfVxuXG4gIGhhc1JlcXVpcmVkRXJyb3IoY29udHJvbE5hbWUpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5jb250cm9sQ29udGFpbnNFcnJvcnMoY29udHJvbE5hbWUpICYmIHRoaXMuZm9ybUdyb3VwLmNvbnRyb2xzW2NvbnRyb2xOYW1lXS5lcnJvcnMucmVxdWlyZWQ7XG4gIH1cblxuICBoYXNJbnZhbGlkRGF0ZUVycm9yKGNvbnRyb2xOYW1lKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuY29udHJvbENvbnRhaW5zRXJyb3JzKGNvbnRyb2xOYW1lKSAmJiB0aGlzLmZvcm1Hcm91cC5jb250cm9sc1tjb250cm9sTmFtZV0uZXJyb3JzLmludmFsaWREYXRlO1xuICB9XG5cblxuICBkYXRlVmFsaWRpdHlDaGFuZ2UoKSB7XG4gICAgdGhpcy5kYXRlQ2hhbmdlcy5waXBlKFxuICAgICAgZGVib3VuY2VUaW1lKDIwMCksXG4gICAgICB0YWtlVW50aWwodGhpcy5ub3RpZmllcilcbiAgICApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICB0aGlzLnJlc2V0RXJyb3JzKCk7XG4gICAgICBjb25zdCBkYXkgPSBOdW1iZXIodGhpcy5mb3JtR3JvdXAuZ2V0KHRoaXMuZGF5TmFtZSkudmFsdWUpO1xuICAgICAgY29uc3QgbW9udGggPSB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5tb250aE5hbWUpLnZhbHVlIC0gMTtcbiAgICAgIGNvbnN0IHllYXIgPSBOdW1iZXIodGhpcy5mb3JtR3JvdXAuZ2V0KHRoaXMueWVhck5hbWUpLnZhbHVlKTtcbiAgICAgIHRoaXMuY2hlY2tEYXRlVmFsaWRpdHkoZGF5LCBtb250aCwgeWVhcik7XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldEZpZWxkcygpIHtcbiAgICByZXR1cm4geyBkYXk6IHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLmRheU5hbWUpLnZhbHVlLCBtb250aDogdGhpcy5nZXRNb250aFZhbHVlKHRydWUpLCB5ZWFyOiB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy55ZWFyTmFtZSkudmFsdWUgfVxuICB9XG5cbiAgLyoqKiBSZXR1cm5zIEZvcm1Hcm91cCBtb250aCBmaWVsZCB2YWx1ZSAqL1xuICBwcml2YXRlIGdldE1vbnRoVmFsdWUoY29ycmVjdEZvck1vbWVudD86IGJvb2xlYW4pIHtcbiAgICBsZXQgIHZhbHVlID0gdGhpcy5mb3JtR3JvdXAuZ2V0KHRoaXMubW9udGhOYW1lKS52YWx1ZTtcbiAgICBpZiAodmFsdWUgPT09IHRoaXMudW5rbm93bk1vbnRoSXRlbS52YWx1ZSkge1xuICAgICAgdmFsdWUgPSAxO1xuICAgIH1cbiAgICBpZiAoY29ycmVjdEZvck1vbWVudCkge1xuICAgICAgcmV0dXJuIHZhbHVlIC0gMTtcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgYXJlRmllbGRzRmlsbGVkKCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGZpZWxkcyA9IHRoaXMuZ2V0RmllbGRzKCk7XG4gICAgcmV0dXJuIGZpZWxkcy5kYXkgIT0gbnVsbCAmJiBmaWVsZHMubW9udGggIT0gLTEgJiYgZmllbGRzLnllYXIgIT0gbnVsbDtcbiAgfVxuXG4gIGNoZWNrRGF0ZVZhbGlkaXR5KGRheTogbnVtYmVyLCBtb250aDogYW55LCB5ZWFyOiBudW1iZXIpIHtcbiAgICBjb25zdCBmaWVsZHMgPSB0aGlzLmdldEZpZWxkcygpO1xuICAgIGlmICh0aGlzLmFyZUZpZWxkc0ZpbGxlZCgpICYmICFtb21lbnQoW3llYXIsIG1vbnRoLCBkYXldKS5pc1ZhbGlkKCkpIHtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLnllYXJOYW1lKS5zZXRFcnJvcnMoeyBpbnZhbGlkRGF0ZTogdHJ1ZSB9LCB7IGVtaXRFdmVudDogdHJ1ZSB9KTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLm1vbnRoTmFtZSkuc2V0RXJyb3JzKHsgaW52YWxpZERhdGU6IHRydWUgfSwgeyBlbWl0RXZlbnQ6IHRydWUgfSk7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5kYXlOYW1lKS5zZXRFcnJvcnMoeyBpbnZhbGlkRGF0ZTogdHJ1ZSB9LCB7IGVtaXRFdmVudDogdHJ1ZSB9KTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLnNldEVycm9ycyh7IGludmFsaWREYXRlOiB0cnVlIH0sIHsgZW1pdEV2ZW50OiB0cnVlIH0pO1xuXG4gICAgICBpZiAoKHRoaXMucmVxdWlyZWQgfHwgdGhpcy55ZWFyUmVxdWlyZWQgKSAmJiB0aGlzLmFyZUZpZWxkc0ZpbGxlZCgpKSB7XG4gICAgICAgIHJldHVybiB7IGludmFsaWREYXRlIDogdHJ1ZSB9O1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAobW9tZW50KFtmaWVsZHMueWVhciwgZmllbGRzLm1vbnRoLCBmaWVsZHMuZGF5XSkuaXNWYWxpZCgpKXtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLnNldEVycm9ycyhudWxsKTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLnllYXJOYW1lKS5zZXRFcnJvcnMobnVsbCk7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5tb250aE5hbWUpLnNldEVycm9ycyhudWxsKTtcbiAgICAgIHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLmRheU5hbWUpLnNldEVycm9ycyhudWxsKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIHJlc2V0RXJyb3JzKCkge1xuICAgIHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLmRheU5hbWUpLnNldEVycm9ycyhudWxsKTtcbiAgICB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5tb250aE5hbWUpLnNldEVycm9ycyhudWxsKTtcbiAgICB0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy55ZWFyTmFtZSkuc2V0RXJyb3JzKG51bGwpO1xuICB9XG5cbiAgdG9TdHJpbmcoKSB7XG4gICAgbGV0IHJlc3VsdCA9ICcnO1xuICAgIGNvbnN0IGRheSA9IE51bWJlcih0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy5kYXlOYW1lKS52YWx1ZSk7XG4gICAgcmVzdWx0ICs9IGRheSA/ICgnMCcgKyBkYXkpLnNsaWNlKC0yKSArICcvJyA6ICcnO1xuICAgIGNvbnN0IG1vbnRoID0gTnVtYmVyKHRoaXMuZm9ybUdyb3VwLmdldCh0aGlzLm1vbnRoTmFtZSkudmFsdWUpO1xuICAgIHJlc3VsdCArPSBtb250aCA/ICgnMCcgKyBtb250aCkuc2xpY2UoLTIpICsgJy8nIDogJyc7XG4gICAgY29uc3QgeWVhciA9IE51bWJlcih0aGlzLmZvcm1Hcm91cC5nZXQodGhpcy55ZWFyTmFtZSkudmFsdWUpO1xuICAgIHJlc3VsdCArPSB5ZWFyO1xuICAgIHJldHVybiByZXN1bHQgPT09ICcwJyA/IHRoaXMuZGVmYXVsdERpc3BsYXkgOiByZXN1bHQ7XG4gIH1cbn1cbiJdfQ==