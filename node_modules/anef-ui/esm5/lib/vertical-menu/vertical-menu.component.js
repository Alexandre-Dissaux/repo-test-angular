/**
 * @fileoverview added by tsickle
 * Generated from: lib/vertical-menu/vertical-menu.component.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { Component, Input, HostListener } from '@angular/core';
/**
 * @record
 */
export function VMenuItem() { }
if (false) {
    /** @type {?|undefined} */
    VMenuItem.prototype.items;
    /** @type {?|undefined} */
    VMenuItem.prototype.control;
}
var VerticalMenuComponent = /** @class */ (function () {
    function VerticalMenuComponent() {
        this.topOffset = 0;
        this.isWithMarkers = false;
        this.isSingleLevel = true;
        this.targets = [];
    }
    /**
     * @return {?}
     */
    VerticalMenuComponent.prototype.handleScroll = /**
     * @return {?}
     */
    function () {
        var e_1, _a;
        if (!this.targets.length) {
            return;
        }
        /** @type {?} */
        var pos = (document.documentElement.scrollTop || document.body.scrollTop);
        /** @type {?} */
        var toActivate = this.targets[0];
        try {
            for (var _b = tslib_1.__values(this.targets), _c = _b.next(); !_c.done; _c = _b.next()) {
                var elem = _c.value;
                /** @type {?} */
                var threshold = this._getYOffset(elem.target) - 1;
                if (threshold <= pos) {
                    toActivate = elem;
                }
                elem.expanded = false;
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        if (toActivate) {
            toActivate.expanded = true;
        }
    };
    /**
     * @return {?}
     */
    VerticalMenuComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        this.formattedItems = this._parseItems(this.items);
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    VerticalMenuComponent.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (changes.items && changes.items.previousValue != changes.items.currentValue) {
            this.formattedItems = this._parseItems(changes.items.currentValue);
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    VerticalMenuComponent.prototype.onAnchorLink = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // Scroll to the target adding the offset if defined
        /** @type {?} */
        var y = this._getYOffset(event.item.target);
        window.scrollTo({ top: y, behavior: 'smooth' });
    };
    /**
     * @private
     * @param {?} target
     * @return {?}
     */
    VerticalMenuComponent.prototype._getYOffset = /**
     * @private
     * @param {?} target
     * @return {?}
     */
    function (target) {
        /** @type {?} */
        var targetElem = document.querySelector(target);
        if (!targetElem) {
            // In case the target element is unreachable we return a value superior to the max-scroll so it can't be auto-selected
            return document.documentElement.scrollHeight + 1;
        }
        /** @type {?} */
        var y = targetElem.getBoundingClientRect().top + window.pageYOffset - this.topOffset;
        return y;
    };
    /**
     * @private
     * @param {?} items
     * @return {?}
     */
    VerticalMenuComponent.prototype._parseItems = /**
     * @private
     * @param {?} items
     * @return {?}
     */
    function (items) {
        var _this = this;
        var e_2, _a;
        if (!items) {
            return;
        }
        /** @type {?} */
        var formatted = [];
        var _loop_1 = function (item) {
            /** @type {?} */
            var tmpItem = tslib_1.__assign({}, item);
            // Set onclick event if not defined and an id is passed as target
            if (item.target && item.target.indexOf('#') !== -1 && !item.command) {
                tmpItem.command = this_1.onAnchorLink.bind(this_1);
                this_1.targets.push(tmpItem);
            }
            // Status marker specific controls
            if (this_1.isWithMarkers) {
                if (!tmpItem.icon) {
                    tmpItem.icon = 'fa fa-check-circle';
                }
                if (item.control) {
                    delete tmpItem.control;
                    if (!tmpItem.styleClass) {
                        tmpItem.styleClass = '';
                    }
                    this_1.setMarkerStatus(tmpItem, item.control);
                    item.control.statusChanges.subscribe((/**
                     * @param {?} status
                     * @return {?}
                     */
                    function (status) {
                        _this.setMarkerStatus(tmpItem, item.control);
                    }));
                }
            }
            // Recurse
            if (item.items && item.items.length) {
                this_1.isSingleLevel = false;
                tmpItem.items = this_1._parseItems((/** @type {?} */ (item.items)));
            }
            formatted.push(tmpItem);
        };
        var this_1 = this;
        try {
            for (var items_1 = tslib_1.__values(items), items_1_1 = items_1.next(); !items_1_1.done; items_1_1 = items_1.next()) {
                var item = items_1_1.value;
                _loop_1(item);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (items_1_1 && !items_1_1.done && (_a = items_1.return)) _a.call(items_1);
            }
            finally { if (e_2) throw e_2.error; }
        }
        return formatted;
    };
    /**
     * @param {?} item
     * @param {?} control
     * @return {?}
     */
    VerticalMenuComponent.prototype.setMarkerStatus = /**
     * @param {?} item
     * @param {?} control
     * @return {?}
     */
    function (item, control) {
        /** @type {?} */
        var isCompleteValidClass = 'is-complete-valid';
        /** @type {?} */
        var isCompleteInvalidClass = 'is-complete-invalid';
        /** @type {?} */
        var completeWithRejectionErrorKey = 'completeInvalid';
        if (control.valid) {
            this.addClass(item, isCompleteValidClass);
            this.removeClass(item, isCompleteInvalidClass);
        }
        else {
            if (control.errors && completeWithRejectionErrorKey in control.errors) {
                this.addClass(item, isCompleteInvalidClass);
            }
            else {
                this.removeClass(item, isCompleteInvalidClass);
            }
            this.removeClass(item, isCompleteValidClass);
        }
    };
    /**
     * @private
     * @param {?} item
     * @param {?} className
     * @return {?}
     */
    VerticalMenuComponent.prototype.addClass = /**
     * @private
     * @param {?} item
     * @param {?} className
     * @return {?}
     */
    function (item, className) {
        if (!item.styleClass) {
            item.styleClass = className;
        }
        if (-1 === item.styleClass.indexOf(className)) {
            item.styleClass += " " + className;
        }
    };
    /**
     * @private
     * @param {?} item
     * @param {?} className
     * @return {?}
     */
    VerticalMenuComponent.prototype.removeClass = /**
     * @private
     * @param {?} item
     * @param {?} className
     * @return {?}
     */
    function (item, className) {
        item.styleClass = item.styleClass.replace(className, '').trim();
    };
    VerticalMenuComponent.decorators = [
        { type: Component, args: [{
                    // tslint:disable-next-line: component-selector
                    selector: 'anef-vertical-menu',
                    template: "<p-panelMenu\n  [model]=\"formattedItems\"\n  [multiple]=\"multiple\"\n  [style]=\"style\"\n  [styleClass]=\"styleClass\"\n  class=\"anef-ui-vmenu\"\n  [class.no-submenu]=\"isSingleLevel\"\n  [class.with-markers]=\"isWithMarkers\"\n  routerLinkActiveOptions=\"{exact: true}\"\n  ></p-panelMenu>\n",
                    styles: [""]
                }] }
    ];
    VerticalMenuComponent.propDecorators = {
        items: [{ type: Input }],
        style: [{ type: Input }],
        styleClass: [{ type: Input }],
        multiple: [{ type: Input }],
        topOffset: [{ type: Input }],
        isWithMarkers: [{ type: Input }],
        handleScroll: [{ type: HostListener, args: ['window:scroll',] }]
    };
    return VerticalMenuComponent;
}());
export { VerticalMenuComponent };
if (false) {
    /** @type {?} */
    VerticalMenuComponent.prototype.items;
    /** @type {?} */
    VerticalMenuComponent.prototype.style;
    /** @type {?} */
    VerticalMenuComponent.prototype.styleClass;
    /** @type {?} */
    VerticalMenuComponent.prototype.multiple;
    /** @type {?} */
    VerticalMenuComponent.prototype.topOffset;
    /** @type {?} */
    VerticalMenuComponent.prototype.isWithMarkers;
    /** @type {?} */
    VerticalMenuComponent.prototype.isSingleLevel;
    /** @type {?} */
    VerticalMenuComponent.prototype.formattedItems;
    /** @type {?} */
    VerticalMenuComponent.prototype.targets;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVydGljYWwtbWVudS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9hbmVmLXVpLyIsInNvdXJjZXMiOlsibGliL3ZlcnRpY2FsLW1lbnUvdmVydGljYWwtbWVudS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxLQUFLLEVBQVUsWUFBWSxFQUE0QixNQUFNLGVBQWUsQ0FBQzs7OztBQUlqRywrQkFHQzs7O0lBRkMsMEJBQWdEOztJQUNoRCw0QkFBMEI7O0FBRzVCO0lBQUE7UUFZVyxjQUFTLEdBQUcsQ0FBQyxDQUFDO1FBQ2Qsa0JBQWEsR0FBRyxLQUFLLENBQUM7UUFFL0Isa0JBQWEsR0FBRyxJQUFJLENBQUM7UUFFckIsWUFBTyxHQUFlLEVBQUUsQ0FBQztJQTBIM0IsQ0FBQzs7OztJQXZIQyw0Q0FBWTs7O0lBRFo7O1FBRUUsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFO1lBQUUsT0FBTztTQUFFOztZQUUvQixHQUFHLEdBQUcsQ0FBQyxRQUFRLENBQUMsZUFBZSxDQUFDLFNBQVMsSUFBSSxRQUFRLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQzs7WUFDdkUsVUFBVSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDOztZQUNoQyxLQUFtQixJQUFBLEtBQUEsaUJBQUEsSUFBSSxDQUFDLE9BQU8sQ0FBQSxnQkFBQSw0QkFBRTtnQkFBNUIsSUFBTSxJQUFJLFdBQUE7O29CQUNQLFNBQVMsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDO2dCQUNuRCxJQUFJLFNBQVMsSUFBSSxHQUFHLEVBQUU7b0JBQ3BCLFVBQVUsR0FBRyxJQUFJLENBQUM7aUJBQ25CO2dCQUNELElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO2FBQ3ZCOzs7Ozs7Ozs7UUFDRCxJQUFJLFVBQVUsRUFBRTtZQUNk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RTtZQUNwQixJQUFJLENBQUMsVUFBVSxHQUFHLFNBQVMsQ0FBQztTQUM3QjtRQUNELElBQUksQ0FBQyxDQUFDLEtBQUssSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDN0MsSUFBSSxDQUFDLFVBQVUsSUFBSSxNQUFJLFNBQVcsQ0FBQztTQUNwQztJQUNILENBQUM7Ozs7Ozs7SUFFTywyQ0FBVzs7Ozs7O0lBQW5CLFVBQW9CLElBQWMsRUFBRSxTQUFpQjtRQUNuRCxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUNsRSxDQUFDOztnQkExSUYsU0FBUyxTQUFDOztvQkFFVCxRQUFRLEVBQUUsb0JBQW9CO29CQUM5QixvVEFBNkM7O2lCQUU5Qzs7O3dCQUdFLEtBQUs7d0JBQ0wsS0FBSzs2QkFDTCxLQUFLOzJCQUNMLEtBQUs7NEJBQ0wsS0FBSztnQ0FDTCxLQUFLOytCQU1MLFlBQVksU0FBQyxlQUFlOztJQXdIL0IsNEJBQUM7Q0FBQSxBQTNJRCxJQTJJQztTQXJJWSxxQkFBcUI7OztJQUVoQyxzQ0FBNEI7O0lBQzVCLHNDQUFvQjs7SUFDcEIsMkNBQTRCOztJQUM1Qix5Q0FBMkI7O0lBQzNCLDBDQUF1Qjs7SUFDdkIsOENBQStCOztJQUUvQiw4Q0FBcUI7O0lBQ3JCLCtDQUEyQjs7SUFDM0Isd0NBQXlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBIb3N0TGlzdGVuZXIsIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcyB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQWJzdHJhY3RDb250cm9sIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHtNZW51SXRlbX0gZnJvbSAncHJpbWVuZy9hcGknO1xuXG5leHBvcnQgaW50ZXJmYWNlIFZNZW51SXRlbSBleHRlbmRzIE1lbnVJdGVtIHtcbiAgaXRlbXM/OiBNZW51SXRlbVtdIHwgTWVudUl0ZW1bXVtdIHwgVk1lbnVJdGVtW107XG4gIGNvbnRyb2w/OiBBYnN0cmFjdENvbnRyb2w7XG59XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6IGNvbXBvbmVudC1zZWxlY3RvclxuICBzZWxlY3RvcjogJ2FuZWYtdmVydGljYWwtbWVudScsXG4gIHRlbXBsYXRlVXJsOiAnLi92ZXJ0aWNhbC1tZW51LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vdmVydGljYWwtbWVudS5jb21wb25lbnQuY3NzJ11cbn0pXG5leHBvcnQgY2xhc3MgVmVydGljYWxNZW51Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgpIGl0ZW1zOiBWTWVudUl0ZW1bXTtcbiAgQElucHV0KCkgc3R5bGU6IGFueTtcbiAgQElucHV0KCkgc3R5bGVDbGFzczogc3RyaW5nO1xuICBASW5wdXQoKSBtdWx0aXBsZTogYm9vbGVhbjtcbiAgQElucHV0KCkgdG9wT2Zmc2V0ID0gMDtcbiAgQElucHV0KCkgaXNXaXRoTWFya2VycyA9IGZhbHNlO1xuXG4gIGlzU2luZ2xlTGV2ZWwgPSB0cnVlO1xuICBmb3JtYXR0ZWRJdGVtczogTWVudUl0ZW1bXTtcbiAgdGFyZ2V0czogTWVudUl0ZW1bXSA9IFtdO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzpzY3JvbGwnKVxuICBoYW5kbGVTY3JvbGwoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnRhcmdldHMubGVuZ3RoKSB7IHJldHVybjsgfVxuXG4gICAgY29uc3QgcG9zID0gKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3ApO1xuICAgIGxldCB0b0FjdGl2YXRlID0gdGhpcy50YXJnZXRzWzBdO1xuICAgIGZvciAoY29uc3QgZWxlbSBvZiB0aGlzLnRhcmdldHMpIHtcbiAgICAgIGNvbnN0IHRocmVzaG9sZCA9IHRoaXMuX2dldFlPZmZzZXQoZWxlbS50YXJnZXQpIC0gMTtcbiAgICAgIGlmICh0aHJlc2hvbGQgPD0gcG9zKSB7XG4gICAgICAgIHRvQWN0aXZhdGUgPSBlbGVtO1xuICAgICAgfVxuICAgICAgZWxlbS5leHBhbmRlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBpZiAodG9BY3RpdmF0ZSkge1xuICAgICAgdG9BY3RpdmF0ZS5leHBhbmRlZCA9IHRydWU7XG4gICAgfVxuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5mb3JtYXR0ZWRJdGVtcyA9IHRoaXMuX3BhcnNlSXRlbXModGhpcy5pdGVtcyk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgaWYgKGNoYW5nZXMuaXRlbXMgJiYgY2hhbmdlcy5pdGVtcy5wcmV2aW91c1ZhbHVlICE9IGNoYW5nZXMuaXRlbXMuY3VycmVudFZhbHVlKSB7XG4gICAgICB0aGlzLmZvcm1hdHRlZEl0ZW1zID0gdGhpcy5fcGFyc2VJdGVtcyhjaGFuZ2VzLml0ZW1zLmN1cnJlbnRWYWx1ZSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIG9uQW5jaG9yTGluayhldmVudCk6IHZvaWQge1xuICAgIC8vIFNjcm9sbCB0byB0aGUgdGFyZ2V0IGFkZGluZyB0aGUgb2Zmc2V0IGlmIGRlZmluZWRcbiAgICBjb25zdCB5ID0gdGhpcy5fZ2V0WU9mZnNldChldmVudC5pdGVtLnRhcmdldCk7XG4gICAgd2luZG93LnNjcm9sbFRvKHt0b3A6IHksIGJlaGF2aW9yOiAnc21vb3RoJ30pO1xuICB9XG5cbiAgcHJpdmF0ZSBfZ2V0WU9mZnNldCh0YXJnZXQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgdGFyZ2V0RWxlbSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IodGFyZ2V0KTtcbiAgICBpZiAoIXRhcmdldEVsZW0pIHtcbiAgICAgIC8vIEluIGNhc2UgdGhlIHRhcmdldCBlbGVtZW50IGlzIHVucmVhY2hhYmxlIHdlIHJldHVybiBhIHZhbHVlIHN1cGVyaW9yIHRvIHRoZSBtYXgtc2Nyb2xsIHNvIGl0IGNhbid0IGJlIGF1dG8tc2VsZWN0ZWRcbiAgICAgIHJldHVybiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0ICsgMTtcbiAgICB9XG4gICAgY29uc3QgeSA9IHRhcmdldEVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wICsgd2luZG93LnBhZ2VZT2Zmc2V0IC0gdGhpcy50b3BPZmZzZXQ7XG4gICAgcmV0dXJuIHk7XG4gIH1cblxuICBwcml2YXRlIF9wYXJzZUl0ZW1zKGl0ZW1zOiBWTWVudUl0ZW1bXSk6IE1lbnVJdGVtW10ge1xuICAgIGlmICghaXRlbXMpIHsgcmV0dXJuOyB9XG4gICAgY29uc3QgZm9ybWF0dGVkOiBNZW51SXRlbVtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgIGNvbnN0IHRtcEl0ZW0gPSB7IC4uLml0ZW0gfTtcblxuICAgICAgLy8gU2V0IG9uY2xpY2sgZXZlbnQgaWYgbm90IGRlZmluZWQgYW5kIGFuIGlkIGlzIHBhc3NlZCBhcyB0YXJnZXRcbiAgICAgIGlmIChpdGVtLnRhcmdldCAmJiBpdGVtLnRhcmdldC5pbmRleE9mKCcjJykgIT09IC0xICYmICFpdGVtLmNvbW1hbmQpIHtcbiAgICAgICAgdG1wSXRlbS5jb21tYW5kID0gdGhpcy5vbkFuY2hvckxpbmsuYmluZCh0aGlzKTtcbiAgICAgICAgdGhpcy50YXJnZXRzLnB1c2godG1wSXRlbSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0YXR1cyBtYXJrZXIgc3BlY2lmaWMgY29udHJvbHNcbiAgICAgIGlmICh0aGlzLmlzV2l0aE1hcmtlcnMpIHtcbiAgICAgICAgaWYgKCF0bXBJdGVtLmljb24pIHtcbiAgICAgICAgICB0bXBJdGVtLmljb24gPSAnZmEgZmEtY2hlY2stY2lyY2xlJztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChpdGVtLmNvbnRyb2wpIHtcbiAgICAgICAgICBkZWxldGUgdG1wSXRlbS5jb250cm9sO1xuXG4gICAgICAgICAgaWYgKCF0bXBJdGVtLnN0eWxlQ2xhc3MpIHtcbiAgICAgICAgICAgIHRtcEl0ZW0uc3R5bGVDbGFzcyA9ICcnO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRoaXMuc2V0TWFya2VyU3RhdHVzKHRtcEl0ZW0sIGl0ZW0uY29udHJvbCk7XG5cbiAgICAgICAgICBpdGVtLmNvbnRyb2wuc3RhdHVzQ2hhbmdlcy5zdWJzY3JpYmUoKHN0YXR1czogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnNldE1hcmtlclN0YXR1cyh0bXBJdGVtLCBpdGVtLmNvbnRyb2wpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJlY3Vyc2VcbiAgICAgIGlmIChpdGVtLml0ZW1zICYmIGl0ZW0uaXRlbXMubGVuZ3RoKSB7XG4gICAgICAgIHRoaXMuaXNTaW5nbGVMZXZlbCA9IGZhbHNlO1xuICAgICAgICB0bXBJdGVtLml0ZW1zID0gdGhpcy5fcGFyc2VJdGVtcyhpdGVtLml0ZW1zIGFzIE1lbnVJdGVtW10pO1xuICAgICAgfVxuXG4gICAgICBmb3JtYXR0ZWQucHVzaCh0bXBJdGVtKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZm9ybWF0dGVkO1xuICB9XG5cbiAgc2V0TWFya2VyU3RhdHVzKGl0ZW06IE1lbnVJdGVtLCBjb250cm9sOiBBYnN0cmFjdENvbnRyb2wpIHtcbiAgICBjb25zdCBpc0NvbXBsZXRlVmFsaWRDbGFzcyA9ICdpcy1jb21wbGV0ZS12YWxpZCc7XG4gICAgY29uc3QgaXNDb21wbGV0ZUludmFsaWRDbGFzcyA9ICdpcy1jb21wbGV0ZS1pbnZhbGlkJztcbiAgICBjb25zdCBjb21wbGV0ZVdpdGhSZWplY3Rpb25FcnJvcktleSA9ICdjb21wbGV0ZUludmFsaWQnO1xuXG4gICAgaWYgKGNvbnRyb2wudmFsaWQpIHtcbiAgICAgIHRoaXMuYWRkQ2xhc3MoaXRlbSwgaXNDb21wbGV0ZVZhbGlkQ2xhc3MpO1xuICAgICAgdGhpcy5yZW1vdmVDbGFzcyhpdGVtLCBpc0NvbXBsZXRlSW52YWxpZENsYXNzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGNvbnRyb2wuZXJyb3JzICYmIGNvbXBsZXRlV2l0aFJlamVjdGlvbkVycm9yS2V5IGluIGNvbnRyb2wuZXJyb3JzKSB7XG4gICAgICAgIHRoaXMuYWRkQ2xhc3MoaXRlbSwgaXNDb21wbGV0ZUludmFsaWRDbGFzcyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLnJlbW92ZUNsYXNzKGl0ZW0sIGlzQ29tcGxldGVJbnZhbGlkQ2xhc3MpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZW1vdmVDbGFzcyhpdGVtLCBpc0NvbXBsZXRlVmFsaWRDbGFzcyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhZGRDbGFzcyhpdGVtOiBNZW51SXRlbSwgY2xhc3NOYW1lOiBzdHJpbmcpIHtcbiAgICBpZiAoIWl0ZW0uc3R5bGVDbGFzcykge1xuICAgICAgaXRlbS5zdHlsZUNsYXNzID0gY2xhc3NOYW1lO1xuICAgIH1cbiAgICBpZiAoLTEgPT09IGl0ZW0uc3R5bGVDbGFzcy5pbmRleE9mKGNsYXNzTmFtZSkpIHtcbiAgICAgIGl0ZW0uc3R5bGVDbGFzcyArPSBgICR7Y2xhc3NOYW1lfWA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVDbGFzcyhpdGVtOiBNZW51SXRlbSwgY2xhc3NOYW1lOiBzdHJpbmcpIHtcbiAgICBpdGVtLnN0eWxlQ2xhc3MgPSBpdGVtLnN0eWxlQ2xhc3MucmVwbGFjZShjbGFzc05hbWUsICcnKS50cmltKCk7XG4gIH1cbn1cbiJdfQ==